<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Export Data | SplitMate</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #7B68EE;
            --primary-dark: #5F4BD8;
            --primary-light: #F0EDFF;
            --secondary: #20C5C5;
            --accent: #FF7E5F;
            --dark: #1A1A2E;
            --darker: #12121A;
            --light: #F9FAFF;
            --lighter: #FFFFFF;
            --gray: #E2E8F0;
            --gray-dark: #94A3B8;
            --success: #2ECC71;
            --danger: #FF4757;
            --warning: #FFA502;
            --border-radius: 24px;
            --border-radius-sm: 12px;
            --border-radius-xs: 8px;
            --box-shadow: 0 24px 48px rgba(0, 0, 0, 0.12);
            --box-shadow-sm: 0 8px 24px rgba(0, 0, 0, 0.08);
            --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            --glass-effect: rgba(255, 255, 255, 0.96);
            --border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #F5F7FF 0%, #EDF0F7 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 24px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            width: 100%;
        }
        
        h1 {
            color: var(--darker);
            font-weight: 700;
            font-size: 38px;
            letter-spacing: -1.2px;
            font-family: 'Space Grotesk', sans-serif;
            position: relative;
            display: inline-block;
        }
        
        h1::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }
        
        .back-btn {
            background: var(--lighter);
            color: var(--primary);
            border: none;
            padding: 14px 24px;
            font-size: 15px;
            font-weight: 600;
            border-radius: var(--border-radius-xs);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--box-shadow-sm);
            text-decoration: none;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(123, 104, 238, 0.15);
            color: var(--primary-dark);
        }
        
        .export-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 32px;
            margin-bottom: 40px;
        }
        
        .export-card {
            background: var(--glass-effect);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: var(--border);
        }
        
        .export-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 32px 64px rgba(0, 0, 0, 0.15);
        }
        
        .export-card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .export-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        
        .export-icon.csv { background: linear-gradient(135deg, var(--success), #27ae60); }
        .export-icon.pdf { background: linear-gradient(135deg, var(--accent), #e55039); }
        .export-icon.json { background: linear-gradient(135deg, var(--warning), #e67e22); }
        .export-icon.excel { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); }
        
        .export-card-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--darker);
            margin-bottom: 8px;
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .export-card-subtitle {
            color: var(--gray-dark);
            font-size: 14px;
        }
        
        .export-card-description {
            color: var(--dark);
            margin-bottom: 28px;
            line-height: 1.6;
        }
        
        .export-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .export-btn {
            background: var(--lighter);
            color: var(--dark);
            border: 1px solid var(--gray);
            padding: 14px 20px;
            font-size: 15px;
            font-weight: 600;
            border-radius: var(--border-radius-xs);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: space-between;
            text-decoration: none;
        }
        
        .export-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(123, 104, 238, 0.2);
        }
        
        .export-btn i {
            font-size: 16px;
        }
        
        .export-btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
        }
        
        .export-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(123, 104, 238, 0.3);
        }
        
        .info-section {
            background: var(--glass-effect);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
            transition: var(--transition);
            border: var(--border);
            text-align: center;
        }
        
        .info-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary), #1db1b1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            font-size: 32px;
            color: white;
        }
        
        .info-title {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--darker);
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .info-description {
            color: var(--gray-dark);
            margin-bottom: 32px;
            font-size: 16px;
            line-height: 1.6;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 32px;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--lighter);
            border-radius: var(--border-radius-xs);
            box-shadow: var(--box-shadow-sm);
        }
        
        .feature-item i {
            color: var(--primary);
            font-size: 18px;
        }
        
        .feature-text {
            font-weight: 600;
            color: var(--dark);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 32px 16px;
            }
            
            .export-grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .export-card {
                padding: 32px;
            }
            
            h1 {
                font-size: 30px;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
        }
        
        /* Animation for cards */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .export-card {
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        
        .export-card:nth-child(1) { animation-delay: 0.1s; }
        .export-card:nth-child(2) { animation-delay: 0.2s; }
        .export-card:nth-child(3) { animation-delay: 0.3s; }
        .export-card:nth-child(4) { animation-delay: 0.4s; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Export Your Data</h1>
            <a href="{{ url_for('analytics') }}" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Analytics
            </a>
        </div>
        
        <!-- Export Options Grid -->
        <div class="export-grid">
            <!-- CSV Export -->
            <div class="export-card">
                <div class="export-card-header">
                    <div class="export-icon csv">
                        <i class="fas fa-file-csv"></i>
                    </div>
                    <div>
                        <div class="export-card-title">CSV Export</div>
                        <div class="export-card-subtitle">Comma-separated values</div>
                    </div>
                </div>
                <div class="export-card-description">
                    Export your data in CSV format for easy analysis in spreadsheet applications like Excel, Google Sheets, or any data analysis tool.
                </div>
                <div class="export-options">
                    <a href="{{ url_for('export_csv', type='expenses') }}" class="export-btn">
                        <span>Export Expenses</span>
                        <i class="fas fa-download"></i>
                    </a>
                    <a href="{{ url_for('export_csv', type='settlements') }}" class="export-btn">
                        <span>Export Settlements</span>
                        <i class="fas fa-download"></i>
                    </a>
                    <a href="{{ url_for('export_csv', type='balances') }}" class="export-btn">
                        <span>Export Friend Balances</span>
                        <i class="fas fa-download"></i>
                    </a>
                </div>
            </div>
            
            <!-- PDF Report -->
            <div class="export-card">
                <div class="export-card-header">
                    <div class="export-icon pdf">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div>
                        <div class="export-card-title">PDF Report</div>
                        <div class="export-card-subtitle">Professional formatted report</div>
                    </div>
                </div>
                <div class="export-card-description">
                    Generate a comprehensive PDF report with summaries, recent expenses, and formatted tables perfect for sharing or archiving.
                </div>
                <div class="export-options">
                    <a href="{{ url_for('export_pdf') }}" class="export-btn export-btn-primary">
                        <span>Generate PDF Report</span>
                        <i class="fas fa-file-pdf"></i>
                    </a>
                </div>
            </div>
            
            <!-- JSON Export -->
            <div class="export-card">
                <div class="export-card-header">
                    <div class="export-icon json">
                        <i class="fas fa-code"></i>
                    </div>
                    <div>
                        <div class="export-card-title">JSON Export</div>
                        <div class="export-card-subtitle">Developer-friendly format</div>
                    </div>
                </div>
                <div class="export-card-description">
                    Export raw data in JSON format, perfect for developers, backup purposes, or importing into other applications.
                </div>
                <div class="export-options">
                    <a href="#" onclick="exportJSON('all')" class="export-btn">
                        <span>Export All Data</span>
                        <i class="fas fa-download"></i>
                    </a>
                    <a href="#" onclick="exportJSON('expenses')" class="export-btn">
                        <span>Export Expenses Only</span>
                        <i class="fas fa-download"></i>
                    </a>
                </div>
            </div>
            
            <!-- Quick Summary -->
            <div class="export-card">
                <div class="export-card-header">
                    <div class="export-icon excel">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div>
                        <div class="export-card-title">Quick Summary</div>
                        <div class="export-card-subtitle">Instant overview</div>
                    </div>
                </div>
                <div class="export-card-description">
                    Get a quick text summary of your spending patterns, balances, and key statistics that you can copy and share.
                </div>
                <div class="export-options">
                    <button onclick="generateQuickSummary()" class="export-btn export-btn-primary">
                        <span>Generate Summary</span>
                        <i class="fas fa-magic"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Information Section -->
        <div class="info-section">
            <div class="info-icon">
                <i class="fas fa-info-circle"></i>
            </div>
            <div class="info-title">Export Information</div>
            <div class="info-description">
                All exports include your complete transaction history with timestamps, friend information, and calculated balances. 
                Your data is processed securely and no information is stored on external servers during the export process.
            </div>
            
            <div class="feature-list">
                <div class="feature-item">
                    <i class="fas fa-shield-alt"></i>
                    <span class="feature-text">Secure Processing</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-clock"></i>
                    <span class="feature-text">Real-time Data</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-file-export"></i>
                    <span class="feature-text">Multiple Formats</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-users"></i>
                    <span class="feature-text">Group Sharing</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Summary Modal -->
    <div id="summaryModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; backdrop-filter: blur(8px);">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--lighter); padding: 40px; border-radius: var(--border-radius); max-width: 600px; width: 90%; box-shadow: var(--box-shadow);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-family: 'Space Grotesk', sans-serif; font-size: 24px; color: var(--darker);">Quick Summary</h3>
                <button onclick="closeSummaryModal()" style="background: none; border: none; font-size: 24px; color: var(--gray-dark); cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="summaryContent" style="background: var(--light); padding: 24px; border-radius: var(--border-radius-xs); font-family: 'Courier New', monospace; white-space: pre-line; max-height: 400px; overflow-y: auto; line-height: 1.6;">
                Loading summary...
            </div>
            <div style="display: flex; gap: 16px; margin-top: 24px; justify-content: flex-end;">
                <button onclick="copySummary()" style="background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: var(--border-radius-xs); cursor: pointer; font-weight: 600;">
                    <i class="fas fa-copy"></i> Copy
                </button>
                <button onclick="closeSummaryModal()" style="background: var(--gray); color: var(--dark); border: none; padding: 12px 24px; border-radius: var(--border-radius-xs); cursor: pointer; font-weight: 600;">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Export JSON data
        async function exportJSON(type) {
            try {
                let data = {};
                
                if (type === 'all' || type === 'expenses') {
                    const expensesResponse = await fetch('/api/chart-data?type=friend_spending');
                    // This is a simplified approach - you'd want to create a proper API endpoint for full JSON export
                    data.message = 'JSON export functionality would be implemented here';
                }
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `splitmate_${type}_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Error exporting JSON:', error);
                alert('Error exporting JSON data');
            }
        }

        // Generate quick summary
        async function generateQuickSummary() {
            document.getElementById('summaryModal').style.display = 'block';
            document.getElementById('summaryContent').textContent = 'Loading summary...';
            
            try {
                // Fetch data from multiple endpoints
                const [friendResponse, monthlyResponse, settlementResponse] = await Promise.all([
                    fetch('/api/chart-data?type=friend_spending'),
                    fetch('/api/chart-data?type=monthly_spending'),
                    fetch('/api/chart-data?type=settlement_trends')
                ]);
                
                const friendData = await friendResponse.json();
                const monthlyData = await monthlyResponse.json();
                const settlementData = await settlementResponse.json();
                
                // Generate summary text
                const totalSpending = monthlyData.data.reduce((sum, d) => sum + d.amount, 0);
                const totalSettlements = settlementData.data.reduce((sum, d) => sum + d.amount, 0);
                const activeFriends = friendData.data.length;
                const totalExpenses = monthlyData.data.reduce((sum, d) => sum + d.expenses_count, 0);
                const avgExpense = totalExpenses > 0 ? totalSpending / totalExpenses : 0;
                
                const currentDate = new Date().toLocaleDateString();
                
                let summary = `SplitMate - Expense Summary
Generated: ${currentDate}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üí∞ FINANCIAL OVERVIEW
Total Spending: ‚Çπ${totalSpending.toLocaleString()}
Total Settlements: ‚Çπ${totalSettlements.toLocaleString()}
Average Expense: ‚Çπ${Math.round(avgExpense).toLocaleString()}
Net Outstanding: ‚Çπ${Math.round(totalSpending - totalSettlements).toLocaleString()}

üë• GROUP STATISTICS
Active Friends: ${activeFriends}
Total Expenses: ${totalExpenses}
Settlement Rate: ${totalExpenses > 0 ? Math.round((settlementData.data.length / totalExpenses) * 100) : 0}%

üìä TOP SPENDERS
`;

                // Add top 3 spenders
                const topSpenders = friendData.data
                    .sort((a, b) => b.total_paid - a.total_paid)
                    .slice(0, 3);
                
                topSpenders.forEach((friend, index) => {
                    summary += `${index + 1}. ${friend.name}: ‚Çπ${friend.total_paid.toLocaleString()}\n`;
                });

                summary += `
üìà RECENT ACTIVITY
Last 6 Months Spending:
`;
                
                monthlyData.data.slice(-6).forEach(month => {
                    summary += `${month.month}: ‚Çπ${month.amount.toLocaleString()}\n`;
                });

                summary += `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Generated by SplitMate - Smart Expense Sharing`;
                
                document.getElementById('summaryContent').textContent = summary;
                
            } catch (error) {
                console.error('Error generating summary:', error);
                document.getElementById('summaryContent').textContent = 'Error generating summary. Please try again.';
            }
        }

        // Copy summary to clipboard
        async function copySummary() {
            const content = document.getElementById('summaryContent').textContent;
            try {
                await navigator.clipboard.writeText(content);
                const copyBtn = event.target;
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                copyBtn.style.background = 'var(--success)';
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = 'var(--primary)';
                }, 2000);
            } catch (error) {
                console.error('Error copying to clipboard:', error);
                alert('Could not copy to clipboard');
            }
        }

        // Close summary modal
        function closeSummaryModal() {
            document.getElementById('summaryModal').style.display = 'none';
        }

        // Close modal when clicking outside
        document.getElementById('summaryModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSummaryModal();
            }
        });
    </script>
</body>
</html>